<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.57.2" />
    <meta name="description" content="hahafamilia blog">
<meta name="author" content="hahafamilia">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Cloudera CDH Configuration :: haha family&#39;s happy blog</title>

    
    <link href="/css/nucleus.css?1580897655" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1580897655" rel="stylesheet">
    <link href="/css/hybrid.css?1580897655" rel="stylesheet">
    <link href="/css/featherlight.min.css?1580897655" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1580897655" rel="stylesheet">
    <link href="/css/auto-complete.css?1580897655" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1580897655" rel="stylesheet">
    <link href="/css/theme.css?1580897655" rel="stylesheet">
    <link href="/css/hugo-theme.css?1580897655" rel="stylesheet">
    
      <link href="/css/theme-custom.css?1580897655" rel="stylesheet">
    

    <script src="/js/jquery-3.3.1.min.js?1580897655"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-145448356-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


  </head>
  <body class="" data-url="/development/cloudera-cdh-configuration/">
    
<nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header" onclick="window.location='https:\/\/hahafamilia.github.io\/';">
    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1580897655"></script>
<script type="text/javascript" src="/js/auto-complete.js?1580897655"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/hahafamilia.github.io\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1580897655"></script>

    
  </div>
    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/development/" title="Development" class="dd-item 
        parent
        
        
        ">
      <a href="/development/">
          <i class='fas fa-angle-right'></i> Development
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
             
            
          
             
            
          
             
            
          
             
            
          
             
            
          
             
            
          
             
            
          
             
            
          
             
            
          
             
            
          
             
            
          
             
            
          
             
            
          
             
            
          
             
            
          
             
            
          
             
            
          
             
            
          
             
            
          
             
            
          
             
            
          
             
            
          
             
            
          
             
            
          
             
            
          
             
            
          
             
            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/howto/" title="HowTo" class="dd-item 
        
        
        
        ">
      <a href="/howto/">
          <i class='fas fa-angle-right'></i> HowTo
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
             
            
          
             
            
          
             
            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/book/" title="Book" class="dd-item 
        
        
        
        ">
      <a href="/book/">
          <i class='fas fa-angle-right'></i> Book
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
             
            
          
             
            
          
             
            
          
             
            
          
             
            
          
             
            
          
             
            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/life/" title="Life" class="dd-item 
        
        
        
        ">
      <a href="/life/">
          <i class='fas fa-angle-right'></i> Life
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
             
            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://github.com/hahafamilia"><i class='fab fa-github'></i> Github</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://hahafamilia.github.io/about"><i class='fas fa-address-card'></i> About</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://tjstory.tistory.com"><i class='fas fa-blog'></i> 이전 블로그</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://hahafamilia.github.io/tags"><i class='fas fa-tags'></i> Tags</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p>Happy <i class="fas fa-heart"></i> hahaFamily</p>
    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'>Development and Life Blog</a> > <a href='/development/'>Development</a> > Cloudera CDH Configuration
          
         
          
         
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li>
<ul>
<li><a href="#version">Version</a></li>
</ul></li>
<li><a href="#yarn">YARN</a>
<ul>
<li><a href="#turning-yarn">Turning YARN</a></li>
</ul></li>
<li><a href="#hive">Hive</a>
<ul>
<li><a href="#ha">HA</a>
<ul>
<li><a href="#절차">절차</a></li>
<li><a href="#check">Check</a></li>
</ul></li>
<li><a href="#hive-metastore-server-ha">Hive Metastore Server HA</a></li>
</ul></li>
<li><a href="#impala">Impala</a>
<ul>
<li><a href="#timezone">timezone</a></li>
<li><a href="#impala-쿼리-oozie-workflow-등록">Impala 쿼리 Oozie Workflow 등록</a></li>
</ul></li>
<li><a href="#oozie">Oozie</a>
<ul>
<li><a href="#schedule-timezone">Schedule Timezone</a></li>
<li><a href="#capture-output-오류">Capture output 오류</a></li>
</ul></li>
<li><a href="#hue">Hue</a>
<ul>
<li><a href="#timezone-1">Timezone</a></li>
</ul></li>
<li><a href="#kafka">Kafka</a>
<ul>
<li><a href="#kafka-manager-jmx">Kafka Manager Jmx</a></li>
<li><a href="#kafka-broker">Kafka Broker</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
<div class="tags">

  <a class="tag-link" href="/tags/2020">2020</a>

  <a class="tag-link" href="/tags/cloudera-cdh6">cloudera-cdh6</a>

  <a class="tag-link" href="/tags/configuration">configuration</a>

  <a class="tag-link" href="/tags/troubleshooting">troubleshooting</a>

</div>

        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Cloudera CDH Configuration
            </h1>
          

        





<p>Bigdata 플랫폼으로 Cloudera CDH 6.1.x 를 운영중 트러블슈팅과 설정에 대해 이야기 해볼게요.</p>

<h3 id="version">Version</h3>

<ul>
<li>Cloudera CDH 6.1</li>
<li>Oracl Java 1.8</li>
</ul>

<h2 id="yarn">YARN</h2>

<h3 id="turning-yarn">Turning YARN</h3>

<p>YARN 의 리소스 관련 설정의 기본 값
<a href="https://docs.cloudera.com/documentation/enterprise/6/6.3/topics/cm_mc_yarn_service.html#id_qv5_4ts_3q">Default Memory Setting</a></p>

<p>YARN 리소스 튜닝 방법
<a href="https://docs.cloudera.com/documentation/enterprise/6/6.3/topics/cdh_ig_yarn_tuning.html">Turning YARN</a></p>

<p>노드의 전체 가용 리소스에서 서비스 데몬들의 리소스 사용량을 제하고
리소스를 할당 해요.
튜닝 문서와는 다르게 Cloudera Manager 에서 각 호스트들의 리소스 사용량은 상이해요.
튜닝 문서와 <em>Cloudera Manager &gt; Host &gt; Worker &gt; Resource</em>  리소스 사용량을 참고하여
Yarn 에 할당할 CPU, Memory 를 결정한 후, 아래의 프로퍼티에 값을 설정해요.
Impala, Kudu, Hbase 를 사용중이면 추가적인 메모리 할당이 필요해요.</p>

<pre><code>yarn.nodemanager.resource.cpu-vcores
yarn.nodemanager.resource.memory-mb

yarn.scheduler.minimum-allocation-vcores
yarn.scheduler.maximum-allocation-vcores
yarn.scheduler.increment-allocation-vcores

yarn.scheduler.minimum-allocation-mb | 1G
yarn.scheduler.maximum-allocation-mb | 101G
yarn.scheduler.increment-allocation-mb | 512M
</code></pre>

<h2 id="hive">Hive</h2>

<h3 id="ha">HA</h3>

<p>공식 문서 <a href="https://docs.cloudera.com/documentation/enterprise/6/6.1/topics/admin_ha_hiveserver2.html">Configuration HiveServer2 HA</a></p>

<h4 id="절차">절차</h4>

<ol>
<li>HAProxy 설정</li>
<li>HiveServer2 인스턴스를 추가</li>
<li>Locate the HiveServer 2 Load Balancer property</li>
<li>Set hostname:port</li>
<li>Restart Hive</li>
</ol>

<h4 id="check">Check</h4>

<ul>
<li>Hive on Spark</li>
<li>Oozie job</li>
<li>Hue Hive / Impala query</li>
<li>scdh api, Impala JDBC</li>
<li>Zeppelin Hive JDBC</li>
</ul>

<blockquote>
<p>Oozie job 들은 Hive LB 주소로 변경되어야 하며 스케쥴은 재제출되어야 해요.<br />
Impala, Oozie Server 는 HiveServer2 설정은 없지만, Restart 필요할 수 있어요.</p>
</blockquote>

<h3 id="hive-metastore-server-ha">Hive Metastore Server HA</h3>

<p>Metastore HA 는 Load balance 기능은 없고
장애시 failover 를 진행 하도록 구성 할 수 있어요.</p>

<h2 id="impala">Impala</h2>

<h3 id="timezone">timezone</h3>

<p>bigint 시간 값을 <code>from_unixtime()</code> 함수를 통해 문자열로 변환하여 사용할 경우,
Hive 같은 경우 현지 timezone 이 적용되는데, Impala 같은 경우 UTC 기준 변환되요.</p>

<p>Impala 구성 <em>Impala Daemon 명령줄 인수 고급 구성</em> 메뉴에 아래와 같이 설정하여
현지 timezone 을 따르게 할 수 있어요.</p>

<pre><code>--use_local_tz_for_unix_timestamp_conversions=true 
--convert_legacy_hive_parquet_utc_timestamps=true
</code></pre>

<h3 id="impala-쿼리-oozie-workflow-등록">Impala 쿼리 Oozie Workflow 등록</h3>

<p>Bash 쉘을 통해 <code>impala-shell</code> CLI 를 사용해서 Shell 을 실행하거나
Impala 쿼리를 Oozie Workflow 를 등록하여 배치를 작성할 수 있는데요.
<code>PYTHON_EGG_CACHE</code> 오류가 발생 할 수 있어요. Shell 상단에 캐시 경로를 지정해 주면 되요.</p>

<pre><code class="language-bash">export PYTHON_EGG_CACHE=/tmp/.python-eggs
</code></pre>

<h2 id="oozie">Oozie</h2>

<h3 id="schedule-timezone">Schedule Timezone</h3>

<p>Oozie Server 에 Workflow 를 예약등록 할때 사용되어지는 Timezone 을 변경해야해요.
Oozie 구성 <em>oozie-site.xml에 대한 Oozie Server 고급 구성</em> 에 값을 추가하여 설정해요.</p>

<pre><code>oozie.processing.timezone
GMT+0900
</code></pre>

<h3 id="capture-output-오류">Capture output 오류</h3>

<p>Workflow 실패의 원인 중에 <code>capture output</code> 을 사용할 경우,
output 사이즈가 기본설정값(2048) 을 초과하여 오류가 발생 할 수 있어요.
Oozie 구성 <em>action-conf/default.xml 에 대한 Oozie Server 고급 구성</em> 에
값을 추가하여 사이즈 설정 할 수 있어요.</p>

<pre><code>oozie.action.max.output.data
10240
</code></pre>

<h2 id="hue">Hue</h2>

<h3 id="timezone-1">Timezone</h3>

<p>Hue UI의 Timezone 설정은 <em>time_zone</em> 에 값을 <code>Asis/Seoul</code> 변경해요.</p>

<h2 id="kafka">Kafka</h2>

<h3 id="kafka-manager-jmx">Kafka Manager Jmx</h3>

<p><a href="https://github.com/yahoo/kafka-manager">Kafka Manager</a>
는 Kafka 클러스터를 모니터링 할 수 있는 좋은 도구 인데요.
Kafka Jmx 서버에 접속하여 매트릭스를 수집해요.
그런데, Kafka 는 JMX 서버를 127.0.0.1 로 바인딩하기 때문에, 공인/사설 IP 간의 접속이 불가능해요.
Kafka 구성 <em>Additional Broker Java Optoins</em> 설정에서 Jmx 포트를 0.0.0.0 으로 바인딩 해주세요.</p>

<pre><code>-Dcom.sun.management.jmxremote.host=0.0.0.0 -Dcom.sun.management.jmxremote.local.only=true
</code></pre>

<h3 id="kafka-broker">Kafka Broker</h3>

<p>역시나 공인/사설 환경에서 producer API 서버에서 Kafka Broker 에 접속하기 위해서는
Kafka Broker 서버를 0.0.0.0 으로 바인딩 해야 해요.
Kafka 구성 <em>kafka.properties에 대한 Kafka Broker 고급 구성</em> 설정에서
각 Borker 마다 아래와 같이 설정해주세요.</p>

<pre><code>#listeners=PLAINTEXT://0.0.0.0:9092
#advertised.listeners=PLAINTEXT://[공인IP]:9092
</code></pre>


<footer class=" footline" >
	
</footer>


        
        </div> 
        
<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {

    
    var logicalName = 'cloudera-cdh-configuration.md';
    var relPermalink = '\/development\/cloudera-cdh-configuration\/';
    if (logicalName == "_index.md" || relPermalink == "/tags/" || relPermalink.includes("/tags/"))
        return;
        
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'hahafamilia';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
                        
            
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
        
                    
            
        
                    
            
        
        
        


	 
	 
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1580897655"></script>
    <script src="/js/perfect-scrollbar.min.js?1580897655"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1580897655"></script>
    <script src="/js/jquery.sticky.js?1580897655"></script>
    <script src="/js/featherlight.min.js?1580897655"></script>
    <script src="/js/highlight.pack.js?1580897655"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1580897655"></script>
    <script src="/js/learn.js?1580897655"></script>
    <script src="/js/hugo-learn.js?1580897655"></script>

    <link href="/mermaid/mermaid.css?1580897655" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1580897655"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>


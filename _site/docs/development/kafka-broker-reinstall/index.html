<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-145448356-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-145448356-1', { 'anonymize_ip': true }); </script> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>Kafka Broker 디스크 증설, RAID구성, OS 재설치 | HAHAFAM</title><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Kafka Broker 디스크 증설, RAID구성, OS 재설치" /><meta property="og:locale" content="en_US" /><meta name="description" content="hahafamilia" /><meta property="og:description" content="hahafamilia" /><link rel="canonical" href="http://localhost:4000/docs/development/kafka-broker-reinstall/" /><meta property="og:url" content="http://localhost:4000/docs/development/kafka-broker-reinstall/" /><meta property="og:site_name" content="HAHAFAM" /><meta property="og:type" content="website" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Kafka Broker 디스크 증설, RAID구성, OS 재설치" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","description":"hahafamilia","headline":"Kafka Broker 디스크 증설, RAID구성, OS 재설치","url":"http://localhost:4000/docs/development/kafka-broker-reinstall/"}</script><body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg><div class="side-bar"><div class="site-header"> <a href="http://localhost:4000/" class="site-title lh-tight"> HAHAFAM </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a></div><nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item"><a href="http://localhost:4000/" class="nav-list-link">Home</a><li class="nav-list-item"><a href="http://localhost:4000/docs/configuration/" class="nav-list-link">Configuration</a><li class="nav-list-item"><a href="http://localhost:4000/docs/customization/" class="nav-list-link">Customization</a><li class="nav-list-item"><a href="http://localhost:4000/about/" class="nav-list-link">About</a><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/docs/book/" class="nav-list-link">book</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/docs/book/%EB%AA%A8%EB%93%A0%EC%A3%BC%EC%8B%9D%EC%9D%84%EC%86%8C%EC%9C%A0%ED%95%98%EB%9D%BC/" class="nav-list-link" style="font-size: small !important">모든 주식을 소유하라</a><li class="nav-list-item "><a href="http://localhost:4000/docs/book/%EB%B3%B4%EB%8F%84%EC%84%80%ED%8D%BC%EC%9D%98%EB%8F%88/" class="nav-list-link" style="font-size: small !important">보도섀퍼의돈</a><li class="nav-list-item "><a href="http://localhost:4000/docs/book/%EC%8A%A4%ED%8C%8C%ED%81%AC%EC%99%84%EB%B2%BD%EA%B0%80%EC%9D%B4%EB%93%9C/" class="nav-list-link" style="font-size: small !important">스파크 완벽 가이드</a><li class="nav-list-item "><a href="http://localhost:4000/docs/book/%EC%9D%B4%EC%9B%83%EC%A7%91%EB%B0%B1%EB%A7%8C%EC%9E%A5%EC%9E%90-%EB%B3%80%ED%95%98%EC%A7%80%EC%95%8A%EB%8A%94%EB%B6%80%EC%9D%98%EB%B2%95%EC%B9%99/" class="nav-list-link" style="font-size: small !important">이웃집백만장자 변하지않는부의법칙</a><li class="nav-list-item "><a href="http://localhost:4000/docs/book/%EC%B9%B4%ED%94%84%EC%B9%B4%20%EB%8D%B0%EC%9D%B4%ED%84%B0%20%ED%94%8C%EB%9E%AB%ED%8F%BC%EC%9D%98%20%EC%B5%9C%EA%B0%95%EC%9E%90/" class="nav-list-link" style="font-size: small !important">카프카, 데이터 플랫폼의 최강자</a><li class="nav-list-item "><a href="http://localhost:4000/docs/book/%ED%95%98%EB%91%A1%20%EC%95%A0%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98%20%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98/" class="nav-list-link" style="font-size: small !important">하둡 애플리케이션 아키텍처</a><li class="nav-list-item "><a href="http://localhost:4000/docs/book/%ED%95%98%EC%9D%B4%EB%B8%8C%20%ED%95%B5%EC%8B%AC%EC%A0%95%EB%A6%AC/" class="nav-list-link" style="font-size: small !important">하이브 핵심 정리, Apache Hive Essentials</a></ul><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/docs/development/" class="nav-list-link">development</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/docs/development/apache-hadoop-2.2/" class="nav-list-link" style="font-size: small !important">Apache Hadoop 2.2 운영</a><li class="nav-list-item "><a href="http://localhost:4000/docs/development/apache-hadoop-2.4/" class="nav-list-link" style="font-size: small !important">Apache Hadoop 2.4 운영</a><li class="nav-list-item "><a href="http://localhost:4000/docs/development/apache-hadoop-rollingupgrade-2.4-2.6/" class="nav-list-link" style="font-size: small !important">Apache Hadoop 롤링 업그레이드 2.4.1 to 2.6.0</a><li class="nav-list-item "><a href="http://localhost:4000/docs/development/apache-piglatin/" class="nav-list-link" style="font-size: small !important">Apache Pig Latin</a><li class="nav-list-item "><a href="http://localhost:4000/docs/development/zeppelin-interpreter/" class="nav-list-link" style="font-size: small !important">Apache Zeppelin Interpreter, Hive, Impala</a><li class="nav-list-item "><a href="http://localhost:4000/docs/development/zeppelin-project-build/" class="nav-list-link" style="font-size: small !important">Apache Zeppelin Project Build</a><li class="nav-list-item "><a href="http://localhost:4000/docs/development/zeppelin-upgrade-0.8.2/" class="nav-list-link" style="font-size: small !important">Apache Zeppelin Upgrade from 0.8.1 to 0.8.2</a><li class="nav-list-item "><a href="http://localhost:4000/docs/development/zeppelin-usage/" class="nav-list-link" style="font-size: small !important">Apache Zeppelin Usage</a><li class="nav-list-item "><a href="http://localhost:4000/docs/development/zeppelin-on-cdh/" class="nav-list-link" style="font-size: small !important">Apache Zeppelin on CDH, Yarn</a><li class="nav-list-item "><a href="http://localhost:4000/docs/development/zeppelin-quickstart/" class="nav-list-link" style="font-size: small !important">Apache Zeppelin 설치, QuickStart</a><li class="nav-list-item "><a href="http://localhost:4000/docs/development/spring-kafka-flume/" class="nav-list-link" style="font-size: small !important">AvroFlumeEvent, 이벤트 데이터의 발생 시각에 따른 데이터 수집</a><li class="nav-list-item "><a href="http://localhost:4000/docs/development/cloudera-cdh-6_1-intall/" class="nav-list-link" style="font-size: small !important">Cloudera CDH 6.1.1 설치하기</a><li class="nav-list-item "><a href="http://localhost:4000/docs/development/cloudera-cdh-configuration/" class="nav-list-link" style="font-size: small !important">Cloudera CDH Configuration</a><li class="nav-list-item "><a href="http://localhost:4000/docs/development/cloudera-alert-email/" class="nav-list-link" style="font-size: small !important">Cloudera Manager 알람 설정, Gmail SMPT 서버 사용</a><li class="nav-list-item "><a href="http://localhost:4000/docs/development/ffmpeg-music-youtube/" class="nav-list-link" style="font-size: small !important">FFMPEG를 이용해 음악 플레이리스트 동영상 만들기</a><li class="nav-list-item "><a href="http://localhost:4000/docs/development/git/" class="nav-list-link" style="font-size: small !important">Git</a><li class="nav-list-item "><a href="http://localhost:4000/docs/development/hive-java-udf/" class="nav-list-link" style="font-size: small !important">Hive Java UDF, 유니코드</a><li class="nav-list-item "><a href="http://localhost:4000/docs/development/intellij-maven-scala/" class="nav-list-link" style="font-size: small !important">IntelliJ maven scala 프로젝트 설정</a><li class="nav-list-item active"><a href="http://localhost:4000/docs/development/kafka-broker-reinstall/" class="nav-list-link active" style="font-size: small !important">Kafka Broker 디스크 증설, RAID구성, OS 재설치</a><li class="nav-list-item "><a href="http://localhost:4000/docs/development/kafka-manager-installation/" class="nav-list-link" style="font-size: small !important">Kafka Manager 설치</a><li class="nav-list-item "><a href="http://localhost:4000/docs/development/memcache-install-management/" class="nav-list-link" style="font-size: small !important">Memcache 개념과 설치 / 운영</a><li class="nav-list-item "><a href="http://localhost:4000/docs/development/oozie-workflow-email/" class="nav-list-link" style="font-size: small !important">Oozie Workflow Email 알림 설정</a><li class="nav-list-item "><a href="http://localhost:4000/docs/development/presto-installation/" class="nav-list-link" style="font-size: small !important">Presto 설치, PrestoDB, PrestoSQL</a><li class="nav-list-item "><a href="http://localhost:4000/docs/development/python-pyenv-anaconda-mac/" class="nav-list-link" style="font-size: small !important">Python 개발환경, Pyenv, Anaconda3</a><li class="nav-list-item "><a href="http://localhost:4000/docs/development/zabbix-install-memo/" class="nav-list-link" style="font-size: small !important">Zabbix 모니터링 메모</a><li class="nav-list-item "><a href="http://localhost:4000/docs/development/machine-learning-spark-guide/" class="nav-list-link" style="font-size: small !important">고급 분석과 머신러닝 개요</a><li class="nav-list-item "><a href="http://localhost:4000/docs/development/kafka-zookeeper-troubleshooting/" class="nav-list-link" style="font-size: small !important">클러스터 네트워크 일시 장애로 인한 Kafka/Zookeeper 문제해결</a><li class="nav-list-item "><a href="http://localhost:4000/docs/development/hbase-troubleshooting/" class="nav-list-link" style="font-size: small !important">할아버지 클러스터의 엉망진창 HBase 문제해결</a></ul><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/docs/howto/" class="nav-list-link">howto</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/docs/howto/jekyll-github-mistakes-blog/" class="nav-list-link" style="font-size: small !important">Jekyll, Github.io, Minimal mistakes 블로그 만들기, 목차 한글링크 버그</a><li class="nav-list-item "><a href="http://localhost:4000/docs/howto/markdown/" class="nav-list-link" style="font-size: small !important">Markdown 작성법</a><li class="nav-list-item "><a href="http://localhost:4000/docs/howto/hugo-staticgen/" class="nav-list-link" style="font-size: small !important">휴고 설치 및 설정, Learn 테마, Hugo Website</a></ul><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/docs/life/" class="nav-list-link">life</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/docs/life/travel-cebu-2019/" class="nav-list-link" style="font-size: small !important">필리핀 세부 마리바고 블루워터 여름휴가</a></ul></ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search HAHAFAM" aria-label="Search HAHAFAM" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div><nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a href="//github.com/hahafamilia" class="site-button" > hahafamilia on GitHub </a></ul></nav></div><div id="main-content-wrap" class="main-content-wrap"><nav aria-label="Breadcrumb" class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/docs/development/">development</a><li class="breadcrumb-nav-list-item"><span>Kafka Broker 디스크 증설, RAID구성, OS 재설치</span></ol></nav><div id="main-content" class="main-content" role="main"><h2 id="kafka-broker-재설치"> <a href="#kafka-broker-재설치" class="anchor-heading" aria-labelledby="kafka-broker-재설치"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Kafka Broker 재설치</h2><p>Kafka Broker 서버의 디스크 용량을 증설하는 작업을 진행 하게 되었습니다. RAID 10으로 디스크 구성을 변경하다보니 불가피하게 OS를 재설치 합니다. Kafka는 Broker 서버의 장애 상황에서도 서비스를 유지 할 수 있도록 설계되어 있어요. Broker 서버를 1대씩 순차적으로 RAID 구성 및 OS 재설치 진행후에 Partition을 Reassign 할 계획입니다.</p><h3 id="environment"> <a href="#environment" class="anchor-heading" aria-labelledby="environment"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Environment</h3><ul><li>CentOS 7.6<li>Cloudera CDH 6.1.1<li>Cloudera Manager<li>Kafka 2.0.0-cdh6.1.1<li>Kafka Manager<li>Kafka Broker 3대<li>Replication fector 3</ul><h3 id="howto"> <a href="#howto" class="anchor-heading" aria-labelledby="howto"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> HowTo</h3><p>Cloudera Manager 에서 작업대상 Broker 서버를 서비스에서 제거해요. Cloudera Manager의 Host 메뉴에서 해당 서버를 제거하여 CDH 플랫폼에서 호스트를 완전 제거 해요. RAID 를 구성하고 OS를 재설치 진행해요. Cloudera Manager 에서 호스트를 클러스터에 추가하고, Kafka 서비스에서 역할을 할당 해요.</p><p><img src="/assets/images/2019/2019-06-25-12-06-26.png" width="30%" /> 여기까지 진행하고 Broker를 투입하게 되면 Cloudera Manager 에서 나머지 2대의 Broker 서버에 경고가(Lagging Replicas Test) 표시 되요. Kafka 는 Broker가 재투입 되더라도 Partition을 자동으로 재조정 하지 않기 때문이예요.</p><p>Kafka Manager 의 Topic 리스트에는 Under Replication 으로 표시되네요.</p><p><img src="/assets/images/2019/2019-06-25-12-07-45.png" alt="Under Replication" /></p><p>파티션을 재조정 하려면 각 Broker에 위치할 파티션들과 Replication 들을 Json 형식으로 일일이 작성해 Kafka Tool 명령어를 사용해야 해요. 이 작업은 매우 번거로울 수 있어요. 다행이 Kafka Manager 가 손쉽게 작업 할 수 있게 도와 주네요.</p><p>Kafka Manager 의 Topic 리스트에 작업할 Topic 의 상세 정보에 보면 Operation 들이 보입니다. Generate Partition Assignments 작업을 수행합니다. 위에서 말한 Json 파일을 만들어 준다고 보시면 되요. 이후 Reassign Partitions 작업을 수행합니다. Broker 서버로 파티션들을 옮기는 작업이예요. 용량에 따라 수분, 수십분이 소요 됩니다.</p><p>아래는 2번째 Topic의 Reassign Partition 작업을 진행하고 6번째 Topic에서 Reassign Partition 작업을 진행 중입니다. 진행 중인 Topic에 대해 하일라이트 표시를 해주고 있네요. Reassign Partition 작업이 완료된 Topic는 Broker 가 3으로 표기되고, Under Replication 은 0으로 표기 되고 있습니다.</p><p>그런데 Borker Leader Skew 가 발생 했네요. Skew는 사전적 의미로 왜곡된 이란 뜻이고, 파티션의 ISR Leader 선출에 문제가 있음을 말해요.</p><p><img src="/assets/images/2019/2019-06-25-12-10-45.png" alt="Reassign Partitio" /></p><p>모든 Topic에 대해 Reassign Partition 작업이 완료 되면 투입된 Broker 디렉토리에 파티션이 할당되었을 거예요. Kafka Data 디렉토리에서 <code class="language-plaintext highlighter-rouge">du -hs</code> 명령어로 데이터 들이 잘 복제 되었음을 확인 할 수 있어요.</p><p>이제 Leader Skew를 해결 합니다. 파티션은 각 Broker로 분배 되어 투입된 Broker에 할당되었지만 투입된 Broker는 아직 파티션의 Leader 역할을 가지고 있지 않기 때문에 Skew가 발생해요. Kafka Manager 에서 Preferred Replica Election 작업을 수행 합니다.</p><hr><footer><p><a href="#top" id="back-to-top">Back to top</a></p><p class="text-small text-grey-dk-100 mb-0">Copyright &copy; 2017-2020 Patrick Marsceill. Distributed by an <a href="https://github.com/just-the-docs/just-the-docs/tree/main/LICENSE.txt">MIT license.</a></p><div class="d-flex mt-2"><p class="text-small text-grey-dk-000 mb-0"> <a href="https://github.com/hahafamilia/hahafamilia.github.io/tree/main/docs/development/kafka-broker-reinstall.md" id="edit-this-page">Edit this page on GitHub</a></p></div></footer></div></div><div class="search-overlay"></div></div>
